--- ../dsniff-2.4b1+debian/urlsnarf.c	2014-07-31 20:55:46.257925178 +0000
+++ /dev/null
@@ -57,8 +56,9 @@
 {
 	static char tstr[32], sign;
 	struct tm *t, gmt;
-	int days, hours, tz, len;
 	time_t tt = time(NULL);
+	int days, hours, tz, len;
+	
 	gmt = *gmtime(&tt);
 	t = localtime(&tt);
 	
@@ -311,48 +311,9 @@
 
         nids_register_chksum_ctl(&chksum_ctl, 1);
 
-	pcap_t *p;
-	char pcap_errbuf[PCAP_ERRBUF_SIZE];
-	if (nids_params.filename == NULL) {
-		/* adapted from libnids.c:open_live() */
-		if (strcmp(nids_params.device, "all") == 0)
-			nids_params.device = "any";
-		p = pcap_open_live(nids_params.device, 16384, 
-				   (nids_params.promisc != 0),
-				   0, pcap_errbuf);
-		if (!p) {
-			fprintf(stderr, "pcap_open_live(): %s\n",
-				pcap_errbuf);
-			exit(1);
-		}
-	}
-	else {
-		p = pcap_open_offline(nids_params.filename, 
-				      pcap_errbuf);
-		if (!p) {
-			fprintf(stderr, "pcap_open_offline(%s): %s\n",
-				nids_params.filename, pcap_errbuf);
-		}
-	}
-
-	struct pcap_pkthdr *h;
-	u_char *d;
-	int rc;
-	while ((rc = pcap_next_ex(p, &h, &d)) == 1) {
-		tt = h->ts.tv_sec;
-		nids_pcap_handler(NULL, h, d);
-	}
-	switch (rc) {
-	case(-2): /* end of pcap file */
-	case(0):  /* timeout on live capture */
-		break;
-	case(-1):
-	default:
-		fprintf(stderr, "rc = %i\n", rc);
-		pcap_perror(p, "pcap_read_ex()");
-		exit(1);
-		break;
-	}
+	nids_run();
+	
+	/* NOTREACHED */
 	
 	exit(0);
 }
